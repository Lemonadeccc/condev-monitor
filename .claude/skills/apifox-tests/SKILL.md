---
name: apifox-tests
description: 执行和解读 Apifox 自动化测试。触发场景：(1) 修改代码后需要验证接口可用性 (2) git commit/push 前的接口检查 (3) 发布版本前的回归测试 (4) 用户明确要求运行 Apifox 测试，或用具体环境跑相关测试 (5) 合并到 main 分支前的自动化检查。选择合适的测试场景或者测试套件，执行测试并解释结果，但不修改测试或命令本身。
---

# Apifox Tests

执行 Apifox 自动化测试并解释结果。

## 工作流程

1. **选择测试**：

- 如果用户在对话中明确提供了：
    - 测试文件路径
    - 测试文件名
    - 或清晰可唯一匹配的测试名称
- 直接使用该测试，不再进行自动选择
- 若信息不明确，应优先通过运行 `node ./.claude/skills/apifox-tests/scripts/list-tests.js` 脚本来快速获取所有的测试文件路径及描述。
- 避免在庞大的项目目录中进行盲目的全局搜索，直接定位到该 Skill 专用的测试文件目录 `tests/`。

2. **多测试执行规则**

- 默认只执行一个测试，但需给出是否批量执行的选择
- 如果用户明确表示：
    - “跑这几个”
    - “全部跑一遍”
- 则进入 **批量执行模式**

批量执行模式下：

- 明确列出将要执行的测试列表
- **询问执行方式**：让用户选择 “按顺序执行” (更易读) 或 “并行执行” (速度快)。
    - **按顺序执行**：逐个运行测试并即时分析，适合调试。
    - **并行执行**：同时启动多个测试（使用 `&` 结尾或脚本并发），适合快速回归，但日志可能会交织。
- 请求用户确认执行方式及测试列表（是 / 否）
- 按选择的方式执行测试
- 最终汇总或依次解释每个测试的结果

3. **确认环境**：

- 支持的环境包括：
    - `dev`
    - `test`
    - `prod`
- 如用户未明确指定环境：
    - 列出上述环境名
    - 让用户确认使用哪一个

4. **执行测试**：

- 在以下信息明确后执行测试：
    - 测试文件路径
    - 环境名（dev / test / prod）

```bash
node ./.claude/skills/apifox-tests/scripts/run-cli.js <测试文件路径><环境名>
```

5. **解释结果**：分析 Apifox CLI 输出，解释失败原因

## 失败处理

- 不修改测试文件
- 不修改执行命令
- 基于测试名称、接口语义和 CLI 输出解释失败原因
